<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation Javascript ES6</title>
    <link rel="stylesheet" href="../css/style.css" />
    <script src="../js/functions.js"></script>
    <script>
        let randNumber = Math.random();
        console.log(randNumber);
        console.log( randNumber*3);
        console.log( randNumber*3 + 1);
        //console.log( Math.round(randNumber*8 + 2) );
        console.log( Math.floor(randNumber*8 + 2) ); /* un nombre avec les limites [2 - 9] */
        //console.log( Math.ceil(randNumber*8 + 2) );

        /*
        Promise = créer une fonction asynchrone dont l'éxécution ne stoppe pas 
        ou ne "fige" pas l'utilisation de la page

        on appelle une fonction asynchrone
        cette fonction va lancer une fonction qui est une promesse, 
        cette promesse : qu'elle renvoi un résultat quoi que soit l'issue de son traitement
        La fonction asynchrone est en attente de réponse de la promesse qui prend du temps et 
        qui pourrai figer la page
        */

        /* asyncCall est la fonction déclarée en asynchrone qui va permettre d'appeler une promesse, elle se met en attente de la réponse de la promesse sans impacter le reste du script */

        async function asyncCall(){
            /* la fonction asynchrone va attendre la réponse d'une autre fonction qui elle attend la réponse d'une promesse */
            let resCall = await resolveFunction(2);
            return resCall;
        }

        function resolveFunction(delai){
            let randError = Math.floor(Math.random()*3 + 1);
            //console.log(randError);
            return new Promise(function(resolve, reject){
            setTimeout(function(){
                    if(randError !== 2){
                        resolve('ça marche');
                    }else{
                        reject('ça marche pas');
                    }
                },delai*1000);
            });
        }

        /* si cette fonction est lancée avant le chargement complet de la page, elle s'éxécute en asynchrone sans gâcher le chargement */
        /*
        asyncCall().then(function(message){
            console.log(message);
            return 'hourra';
        }).then(function(toto){
            console.log(toto);
        }).catch(function(error){
            console.error(error);
        }).finally(function(){
            console.log('appel de la fonction asynchrone finie');
        });
        */
        loaded( function(){
            s('#btn').addEventListener('click', function(){
                // appell de la fonction en asynchrone
                asyncCall().then(function(message){
                    console.log(message);
                    return 'hourra';
                }).then(function(toto){
                    console.log(toto);
                }).catch(function(error){
                    console.error(error);
                }).finally(function(){
                    console.log('appel de la fonction asynchrone finie');
                });
            });
        } );
    </script>
</head>
<body>
    <header>
        <h1>Formation Javascript</h1>
    </header>
    <nav>
        <ul>
            <li>
                Bases
                <ul>
                    <li>
                        <a href="../introduction/index.html">Intro</a>
                    </li>
                    <li>
                        <a href="../introduction/tableaux.html">Tableaux</a>
                    </li>
                    <li>
                        <a href="../introduction/fonctions.html">Fonctions</a>
                    </li>
                    <li>
                        <a href="../introduction/destructuration.html">Destructuration</a>
                    </li>
                    <li>
                        <a href="../introduction/storage.html">storage</a>
                    </li>
                </ul>
            </li>
            <li>
                DOM
                <ul>
                    <li>
                        <a href="../dom/index.html">Le DOM</a>
                    </li>
                    <li>
                        <a href="../dom/dom.html">Créer dans le DOM</a>
                    </li>
                    <li>
                        <a href="../dom/css.html">DOM et CSS</a>
                    </li>
                    <li>
                        <a href="../dom/data-attribute.html">Dataset</a>
                    </li>
                </ul>
            </li>
            <li>
                AJAX
                <ul>
                    <li>
                        <a href="../ajax/index.html">AJAX</a>
                    </li>
                    <li>
                        <a href="../ajax/fetch.html">Fetch</a>
                    </li>
                </ul>
            </li>
            <li>
                POO
                <ul>
                    <li>
                        <a href="../poo/index.html">POO</a>
                    </li>
                    <li>
                        <a href="../poo/collection.html">Collection</a>
                    </li>
                    <li>
                        <a href="../poo/module.html">Module</a>
                    </li>
                    <li>
                        <a href="../poo/classe.html">Classe</a>
                    </li>
                </ul>
            </li>
        </ul>
    </nav>
    <main>
        <section>
            <div>
                <article>
                    <header>
                        <h2>AJAX - Asynchronous JavaScript and Xml</h2>
                    </header>
                    <main>
                        <h3>Promesses</h3>
                        
                        <p>
                            Les promesse c'est une façon de "lancer" une fonction en mode asynchrone :
                            son exécution se fait sans "blocage" de la page : on n'attend pas le retour de la
                            fonction pour continuer le script car on la déclare "en attente de réponse", et quand
                            son traitement est fini c'est à ce moment que le retour intervient
                        </p>
                        <p>
                            <button id="btn">
                                Récupérer une info
                            </button>
                        </p>
                        <p id="result">

                        </p>
                    </main>
                </article>
            </div>
        </section>
    </main>
</body>
<script>
    console.log('le Dom est chargé');
</script>
</html>